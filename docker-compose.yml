# Docker Compose é…ç½®
# ç”¨æ–¼æœ¬åœ°é–‹ç™¼å’Œæ¸¬è©¦ç’°å¢ƒ

version: '3.8'

services:
  test-runner:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: systalk-test-runner
    volumes:
      - .:/app
      - test-results:/app/test-results
      - coverage-reports:/app/htmlcov
    environment:
      - ENVIRONMENT=ci
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo 'ðŸš€ Running all tests...' &&
        pytest -v --cov=. --cov-report=html --cov-report=term &&
        echo 'âœ… Tests completed!'
      "
    networks:
      - test-network

  code-quality:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: systalk-code-quality
    volumes:
      - .:/app
    command: >
      sh -c "
        echo 'ðŸ” Running code quality checks...' &&
        black --check --diff . &&
        isort --check-only --diff . &&
        flake8 . &&
        pylint **/*.py --exit-zero &&
        echo 'âœ… Code quality checks completed!'
      "
    networks:
      - test-network

  security-scan:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: systalk-security-scan
    volumes:
      - .:/app
      - security-reports:/app/security-reports
    command: >
      sh -c "
        echo 'ðŸ”’ Running security scans...' &&
        mkdir -p security-reports &&
        bandit -r . -f json -o security-reports/bandit-report.json || true &&
        bandit -r . &&
        safety check --json || true &&
        echo 'âœ… Security scans completed!'
      "
    networks:
      - test-network

volumes:
  test-results:
  coverage-reports:
  security-reports:

networks:
  test-network:
    driver: bridge
